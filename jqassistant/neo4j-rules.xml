<jqa:jqassistant-rules xmlns:jqa="http://www.buschmais.com/jqassistant/core/analysis/rules/schema/v1.0">

  <group id="default">
    <includeConstraint refId="neo4j-rules:SerializationDoesNotOverwriteFinals"/>
  </group>

  <constraint id="neo4j-rules:SerializationDoesNotOverwriteFinals" severity="blocker">
    <description>
      We want to enable the profitable TrustNonStaticFinalFields optimisations, but this puts some additional
      restrictions on what we can do with final fields.
      In particular, we cannot allow final fields to be modified outside of their constructor.
      This means we cannot allow Java object serialization to overwrite final fields, because it does not go through
      the constructor.
    </description>
    <cypher><![CDATA[
          MATCH
           (field:Field)-[:DECLARES]-(class:Class)-[:IMPLEMENTS|:EXTENDS*]->(ser {fqn: "java.io.Serializable"})
          WHERE
           field.final and field.static is null and not field.transient
          RETURN
           field
        ]]></cypher>
  </constraint>

</jqa:jqassistant-rules>
